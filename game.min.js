(function(){"use strict";function e([e,...t],...n){return n.reduce((e,n)=>e.concat(n,t.shift()),[e]).filter((e)=>null!=e).join("")}function n(...e){return Object.assign({},...e)}function r(e){return"#"===e.charAt(0)&&(e=e.substr(1)),3===e.length&&(e=e.split("").map((e)=>e+e).join("")),e.match(/.{1,2}/g).map((e)=>parseFloat((parseInt(e,16)/255).toFixed(2)))}function o(e){return e.reduce((e,t)=>{let n=(~~(255*t)).toString(16);return 1===n.length&&(n="0"+n),e+n},"#")}function a(e,t,n){let o,r,a;if(0==t)o=r=a=n;else{function i(e,n,r){return 0>r&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(n-e)*r:r<1/2?n:r<2/3?e+6*((n-e)*(2/3-r)):e}let s=0.5>n?n*(1+t):n+t-n*t,c=2*n-s;o=i(c,s,e+1/3),r=i(c,s,e),a=i(c,s,e-1/3)}return[o,r,a]}function i(){let e=new Je(3);return e[0]=0,e[1]=0,e[2]=0,e}function s(e,t,n){let r=new Je(3);return r[0]=e,r[1]=t,r[2]=n,r}function c(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function m(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function _(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function d(e,t){let n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return Le(n*n+r*r+o*o)}function p(e,t){let n=t[0],r=t[1],o=t[2],a=n*n+r*r+o*o;return 0<a&&(a=1/Le(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function l(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function f(e,t,n){let r=t[0],o=t[1],a=t[2],i=n[0],s=n[1],c=n[2];return e[0]=o*c-a*s,e[1]=a*i-r*c,e[2]=r*s-o*i,e}function u(e,n,r,o){let t=n[0],a=n[1],i=n[2];return e[0]=t+o*(r[0]-t),e[1]=a+o*(r[1]-a),e[2]=i+o*(r[2]-i),e}function g(e,t,n){let r=t[0],o=t[1],a=t[2],i=n[3]*r+n[7]*o+n[11]*a+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*o+n[8]*a+n[12])/i,e[1]=(n[1]*r+n[5]*o+n[9]*a+n[13])/i,e[2]=(n[2]*r+n[6]*o+n[10]*a+n[14])/i,e}function h(){let e=new Je(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){let n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5],c=t[6],m=t[7],d=t[8],_=t[9],l=t[10],f=t[11],u=t[12],p=t[13],g=t[14],h=t[15],v=n*s-r*i,y=n*c-o*i,b=n*m-a*i,k=r*c-o*s,x=r*m-a*s,A=o*m-a*c,E=d*p-_*u,F=d*g-l*u,R=d*h-f*u,T=_*g-l*p,w=_*h-f*p,L=l*h-f*g,P=v*L-y*w+b*T+k*R-x*F+A*E;return P?(P=1/P,e[0]=(s*L-c*w+m*T)*P,e[1]=(o*w-r*L-a*T)*P,e[2]=(p*A-g*x+h*k)*P,e[3]=(l*x-_*A-f*k)*P,e[4]=(c*R-i*L-m*F)*P,e[5]=(n*L-o*R+a*F)*P,e[6]=(g*b-u*A-h*y)*P,e[7]=(d*A-l*b+f*y)*P,e[8]=(i*w-s*R+m*E)*P,e[9]=(r*R-n*w-a*E)*P,e[10]=(u*x-p*b+h*v)*P,e[11]=(_*b-d*x-f*v)*P,e[12]=(s*F-i*T-c*E)*P,e[13]=(n*T-r*F+o*E)*P,e[14]=(p*y-u*k-g*v)*P,e[15]=(d*k-_*y+l*v)*P,e):null}function y(e,t,n){let r=t[0],o=t[1],a=t[2],i=t[3],s=t[4],c=t[5],m=t[6],d=t[7],_=t[8],l=t[9],f=t[10],u=t[11],p=t[12],g=t[13],h=t[14],v=t[15],y=n[0],b=n[1],k=n[2],x=n[3];return e[0]=y*r+b*s+k*_+x*p,e[1]=y*o+b*c+k*l+x*g,e[2]=y*a+b*m+k*f+x*h,e[3]=y*i+b*d+k*u+x*v,y=n[4],b=n[5],k=n[6],x=n[7],e[4]=y*r+b*s+k*_+x*p,e[5]=y*o+b*c+k*l+x*g,e[6]=y*a+b*m+k*f+x*h,e[7]=y*i+b*d+k*u+x*v,y=n[8],b=n[9],k=n[10],x=n[11],e[8]=y*r+b*s+k*_+x*p,e[9]=y*o+b*c+k*l+x*g,e[10]=y*a+b*m+k*f+x*h,e[11]=y*i+b*d+k*u+x*v,y=n[12],b=n[13],k=n[14],x=n[15],e[12]=y*r+b*s+k*_+x*p,e[13]=y*o+b*c+k*l+x*g,e[14]=y*a+b*m+k*f+x*h,e[15]=y*i+b*d+k*u+x*v,e}function b(e,t,n,r){let o=t[0],a=t[1],i=t[2],s=t[3],c=o+o,m=a+a,d=i+i,_=o*c,l=o*m,f=o*d,u=a*m,p=a*d,g=i*d,h=s*c,v=s*m,y=s*d,b=r[0],k=r[1],x=r[2];return e[0]=(1-(u+g))*b,e[1]=(l+y)*b,e[2]=(f-v)*b,e[3]=0,e[4]=(l-y)*k,e[5]=(1-(_+g))*k,e[6]=(p+h)*k,e[7]=0,e[8]=(f+v)*x,e[9]=(p-h)*x,e[10]=(1-(_+u))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function k(e,t,n,r,o){let a=1/Math.tan(t/2),i=1/(r-o);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+r)*i,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*r*i,e[15]=0,e}function x(e,t,n,r){let o,a,i,s,c,m,d,_,l,f,u=t[0],p=t[1],g=t[2],h=r[0],v=r[1],y=r[2],b=n[0],k=n[1],x=n[2];return Te(u-b)<Ke&&Te(p-k)<Ke&&Te(g-x)<Ke?mat4.identity(e):(d=u-b,_=p-k,l=g-x,f=1/Le(d*d+_*_+l*l),d*=f,_*=f,l*=f,o=v*l-y*_,a=y*d-h*l,i=h*_-v*d,f=Le(o*o+a*a+i*i),f?(f=1/f,o*=f,a*=f,i*=f):(o=0,a=0,i=0),s=_*i-l*a,c=l*o-d*i,m=d*a-_*o,f=Le(s*s+c*c+m*m),f?(f=1/f,s*=f,c*=f,m*=f):(s=0,c=0,m=0),e[0]=o,e[1]=s,e[2]=d,e[3]=0,e[4]=a,e[5]=c,e[6]=_,e[7]=0,e[8]=i,e[9]=m,e[10]=l,e[11]=0,e[12]=-(o*u+a*p+i*g),e[13]=-(s*u+c*p+m*g),e[14]=-(d*u+_*p+l*g),e[15]=1,e)}function A(){let e=new Je(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function E(){let e=new Je(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function F(){let e=new Je(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function R(e,t,n){n*=0.5;let r=Re(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Fe(n),e}function T(e,t,n){let r=t[0],o=t[1],a=t[2],i=t[3],s=n[0],c=n[1],m=n[2],d=n[3];return e[0]=r*d+i*s+o*m-a*c,e[1]=o*d+i*c+a*s-r*m,e[2]=a*d+i*m+r*c-o*s,e[3]=i*d-r*s-o*c-a*m,e}function w(e,n,r,o){let t,a,i,s,c,m=n[0],d=n[1],_=n[2],l=n[3],f=r[0],u=r[1],p=r[2],g=r[3];return a=m*f+d*u+_*p+l*g,0>a&&(a=-a,f=-f,u=-u,p=-p,g=-g),1e-6<1-a?(t=Math.acos(a),i=Re(t),s=Re((1-o)*t)/i,c=Re(o*t)/i):(s=1-o,c=o),e[0]=s*m+c*f,e[1]=s*d+c*u,e[2]=s*_+c*p,e[3]=s*l+c*g,e}function L(e,t){let n,r=t[0]+t[4]+t[8];if(0<r)n=Le(r+1),e[3]=0.5*n,n=0.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);let o=(r+1)%3,a=(r+2)%3;n=Le(t[3*r+r]-t[3*o+o]-t[3*a+a]+1),e[r]=0.5*n,n=0.5/n,e[3]=(t[3*o+a]-t[3*a+o])*n,e[o]=(t[3*o+r]+t[3*r+o])*n,e[a]=(t[3*a+r]+t[3*r+a])*n}return e}function P(e,t,n,r){const o=Float32Array.of(...t,...n,...r);return it(e,L(e,o))}function S(e){return e*Ee/180}function B(e){const t=_t.createBuffer();return _t.bindBuffer(_t.ARRAY_BUFFER,t),_t.bufferData(_t.ARRAY_BUFFER,new Float32Array(e),_t.STATIC_DRAW),t}function U(e){const t=_t.createBuffer();return _t.bindBuffer(_t.ELEMENT_ARRAY_BUFFER,t),_t.bufferData(_t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),_t.STATIC_DRAW),t}function I(e,t){const n=_t.createShader(e);if(_t.shaderSource(n,t),_t.compileShader(n),!_t.getShaderParameter(n,_t.COMPILE_STATUS))throw _t.getShaderInfoLog(n);return n}function q(e,t){const n=_t.createProgram();if(_t.attachShader(n,e),_t.attachShader(n,t),_t.linkProgram(n),!_t.getProgramParameter(n,_t.LINK_STATUS))throw _t.getProgramInfoLog(n);return n}function M(e){Wt=e}function C(e=0,t=1){return Ae(Xt()*(t-e+1)+e)}function D(e=0,t=1){return Xt()*(t-e)+e}function O(e){return e[C(0,e.length-1)]}function N([e,t],n,r=1.5){const o=D(0,2*Ee),a=D(0,n);return ot(e+a*Fe(o),r,t+a*Re(o))}function j(e){const t=D(-Ee/10,Ee/10),n=D(0,Ee/10),r=ot(Fe(n)*Re(t),Re(n),Fe(n)*Fe(t));return p(r,r),g(r,r,e)}function Y(e,t){return e.reduce((e,n,r)=>e+n*t[r],0)}function G(e){return Le(Y(e,e))}function H(e,t){const n=V.slice();return m(n,e,t),G(n)}function W(e){return Le(xe(1-e,2))}function X(e,t,n){const r=H(e,t),o=Le(n*n)/2;return Math.max(0,1-r/o)}function Q(e,t){return Te(Y(e,t))}function K(e,t,n){const o=t.get_component(ht),a=t.get_component(Kt),i=X(e.position,o.position,n),s=Q(e.rotation,o.rotation),c=Q(o.rotation,a.rotation),m=s*(1-W(i))+c*W(i);return(i+m)/2/2}function J(e,t,n){const o=t.get_component(ht),a=X(e.position,o.position,n),i=Q(e.rotation,o.rotation);return(a*Re(i)+i*Re(a))/(0.8414709848078965*2)}function Z(e=0,t=1){return Ae(Math.random()*(t-e+1)+e)}function $(e){return e[Z(0,e.length-1)]}function z(e,t){const n=$t.sampleRate*e,r=$t.createBuffer(2,n,$t.sampleRate),o=r.getChannelData(0),a=r.getChannelData(1);for(let r=0;r<n;r++)o[r]=(2*Math.random()-1)*xe(1-r/n,t),a[r]=(2*Math.random()-1)*xe(1-r/n,t);return r}function ee(e){const t=$t.createOscillator();t.type="sine",t.frequency.value=e;const n=$t.createGain();n.gain.setTargetAtTime(1,$t.currentTime,.1),n.gain.setTargetAtTime(0,$t.currentTime+1,.1),t.connect(n),n.connect(en),t.start(),t.stop($t.currentTime+10)}function te(){const e=$(zt);return ee(e),setTimeout(te,2e3+Z(0,1e4))}function ne(e,t,n,r){this.modulator_gain=e.createGain(),this.modulator_gain.gain.value=r||300,n.connect(this.modulator_gain),this.modulator_gain.connect(t.frequency),this.connect=(e)=>{t.disconnect(),t.connect(e)},this.disconnect=(e)=>{t.disconnect(e)}}function re(e,t,n){var r=e.createGain();r.gain.value=1,t.connect(r),n.connect(r.gain),this.connect=function(e){r.disconnect(),r.connect(e)}}function oe(e,t,n,r,o,a){var i=6.90776;this.attack_time=n||0.9,this.decay_time=r||0.9,this.min=o||0,this.max=a||50,this.trigger=(n)=>{var r=n||e.currentTime;t.cancelScheduledValues(r),t.setValueAtTime(this.min,r),t.setTargetAtTime(this.max,r,this.attack_time/i),t.setTargetAtTime(this.min,r+this.attack_time+1/44100,this.decay_time/i)}}function ae(e,t){const n=7e3,r=300,o=0.9,a=3e3,i=$t.createPanner();i.panningModel="equalpower",i.distanceModel="exponential",i.refDistance=0.3,i.setPosition(...e);const s=$t.createOscillator(),c=$t.createOscillator(),m=$t.createOscillator(),d=$t.createGain(),_=$t.createGain(),l=$t.createGain();c.connect(d),m.connect(_);const f=new ne($t,s,d),u=new re($t,f,_),p=new oe($t,l.gain),g=new oe($t,c.frequency),h=new oe($t,m.frequency),v=new oe($t,d.gain),y=new oe($t,_.gain);u.connect(l),l.connect(i),i.connect($t.destination),f.modulator_gain.gain.value=r+n*nn.ifrq,s.frequency.value=r+n*nn.ifrq,p.attack_time=o*nn.atk,p.decay_time=o*nn.dcy,g.max=a*nn.fmod1,g.attack_time=o*nn.atkf1,g.decay_time=o*nn.dcyf1,h.max=a*nn.fmod2,h.attack_time=o*nn.atkf2,h.decay_time=o*nn.dcyf2,v.max=nn.amod1,v.attack_time=o*nn.atka1,v.decay_time=o*nn.dcya1,y.max=-nn.amod2,y.attack_time=o*nn.atka2,y.decay_time=o*nn.dcya2,l.gain.value=0,s.start(0),c.start(0),m.start(0),p.trigger(t),g.trigger(t),h.trigger(t),v.trigger(t),y.trigger(t)}function ie(e){for(let t=0;3>t;t++)setTimeout(()=>{ae(e,$t.currentTime+0.4*Math.random())},1.2*(1e3*nn.atk)*t)}function se(e,t,n,r,o){ie(e);for(let a=0;a<r;a++)setTimeout(()=>{const r=N([e[0],e[2]],n,100),a=new ft({components:[new ht({position:e,scale:[0.2,0.2,0.2]}),new yt({material:Gt,color:t}),new Et({frame_time:16})]});a.get_component(Et).frames=on,a.get_component(ht).look_at(r),a.get_component(ht).rotate_ud(Ee/2),a.get_component(ht).rotate_rl(Math.PI),a.get_component(Et).create_buffers(),o.add(a),new Zt({object:a.get_component(ht),property:"position",to:r,time:1e3*rn,game:o}).start().then(()=>{o.remove(a)})},15*a)}function ce(e,t){const n=a(e,cn,t);return o(n)}function me(e){M(xe(Vt/e,2)),fn=[],un=[];const t=new Tt({width:window.innerWidth,height:window.innerHeight,clear_color:"#eeeeee",far:an});t.camera.add_component(new xt({keyboard_controlled:!1,mouse_controlled:!1,move_speed:30,rotate_speed:.2}));const n=D(0,1),r=ce(n,mn),o=new Ct;o.get_component(ht).scale=[sn,1,sn],o.get_component(yt).set({material:Gt,color:r}),t.add(o);for(let n=0;n<xe(e,2)+1;n++)Qt(n,r,C(0,2)).forEach((e)=>{fn.push(e),t.add(e)});t.camera.get_component(ht).position=N([0,0],an/3),t.camera.get_component(ht).look_at(O(fn).get_component(ht).position),t.camera.get_component(ht).look_at(j(t.camera.get_component(ht).matrix)),delete t.camera.get_component(xt).dir_desc[69],delete t.camera.get_component(xt).dir_desc[81];const a=C(2,4);for(let t=0;t<a;t++){const e=N([0,0],an/3,-3);un.push(e)}return t.on("afterrender",function e(){t.off("afterrender",e);const n={snapshot:t.canvas.toDataURL(),position:t.camera.get_component(ht).position,rotation:t.camera.get_component(ht).rotation};An(je,n),t.stop()}),[t,n]}function de(e,t,n){e.camera.get_component(ht).set({position:[0,dn,0],rotation:F()}),e.camera.get_component(xt).keyboard_controlled=!0,e.camera.get_component(xt).mouse_controlled=!0,e.camera.add_component(new Kt({target:n}));for(const r of e.entities)r.get_component(yt).color="#000000";e.start(),e.on("tick",()=>{for(let r=0;r<un.length;r++)if(d(un[r],e.camera.get_component(ht).position)<_n){se(un[r],ce(t,mn*K(n,e.camera,an)),an/5,ln,e),un.splice(r,1);break}}),e.on("afterrender",function(){const r=K(n,e.camera,an);for(const n of e.entities)n.get_component(yt).color=ce(t,mn*r)})}function _e(e,t){e.stop();const n=J(t,e.camera,an);return Ae(100*n)}function le(e){hn[e.type]=performance.now()}function fe(){pe();for(const e of["mousemove","keydown"])if(hn[e]+pn<performance.now()){An(Ye,e);break}}function ue(){window.addEventListener("mousemove",le),window.addEventListener("keydown",le),gn=setTimeout(fe,5e3);const e=performance.now();hn={mousemove:e,keydown:e}}function pe(){window.removeEventListener("mousemove",le),window.removeEventListener("keydown",le),clearTimeout(gn)}function ge(e,t=1){return`<div class="ui"
    onanimationend="dispatch(${Be})"
    style="
      background-color: ${e};
      animation: fadein ${t}s forwards reverse"></div>`}function he(e,t,n=1){return`<div class="ui"
    onanimationend="
      dispatch(${Se});
      dispatch(${e.join(", ")})"
    style="
      background-color: ${t};
      animation: fadein ${n}s forwards"></div>`}function ve({next:t},{id:n,from:r,to:o,duration_in:a,duration_out:i},...s){const[c]=t;return null===c?s:e`
    ${s}
    ${c===n?ge(r,a):he(t,o,i)}`}function ye(t){return e`
    <div class="ui"
      onanimationend="dispatch(${Ve})"
      style="
        background: hsl(${360*t}, 70%, 60%);
        animation: fadein 1s 1s forwards reverse;"></div>
    <div class="ui">
      <div class="pad">Find this moment.</div>
    </div>`}function be(){return e`
    <div class="ui action"
      onclick="dispatch(${He}); goto(${Me})">
      <div class="pad">Find this moment.</div>
    </div>`}function ke(t,n){return e`
     <div class="box action"
       onclick="goto(${qe}, ${n})"
       style="color: rgba(255, 255, 255, 0.35);">
       ${t}</div>
  `}var xe=Math.pow,Ae=Math.floor,Ee=Math.PI,Fe=Math.cos,Re=Math.sin,Te=Math.abs,we=Math.min,Le=Math.sqrt;const Pe=100,Se=101,Be=102,Ue=0,Ie=1,qe=2,Me=3,Ce=4,De=5,Oe=6,Ne=10,je=11,Ye=12,Ge=13,He=14,Ve=15,We=51,Xe=52,Qe={current_scene:Ue,next:[Ue]},Ke=1e-6;let Je="undefined"==typeof Float32Array?Array:Float32Array;const Ze=function(e){let t=e[0],n=e[1],r=e[2];return Le(t*t+n*n+r*r)},$e=function(){let e=i();return function(t,n,r,o,a,s){let c,i;for(n||(n=3),r||(r=0),i=o?we(o*n+r,t.length):t.length,c=r;c<i;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],a(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}}(),ze=Float32Array,V=ze.of(0,0,0),et=ze.of(1,1,1),tt=ze.of(1,0,0),nt=ze.of(0,1,0),rt=ze.of(0,0,1),ot=(...e)=>ze.of(...e),at=function(){let e=E();return function(t,n,r,o,a,s){let c,i;for(n||(n=4),r||(r=0),i=o?we(o*n+r,t.length):t.length,c=r;c<i;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],e[3]=t[c+3],a(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2],t[c+3]=e[3];return t}}(),it=function(e,t){let n=t[0],r=t[1],o=t[2],a=t[3],i=n*n+r*r+o*o+a*a;return 0<i&&(i=1/Le(i),e[0]=n*i,e[1]=r*i,e[2]=o*i,e[3]=a*i),e},st=function(){let e=i(),t=s(1,0,0),n=s(0,1,0);return function(r,o,a){let i=l(o,a);return-0.999999>i?(f(e,t,o),1e-6>Ze(e)&&f(e,n,o),p(e,e),R(r,e,Math.PI),r):0.999999<i?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(f(e,o,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+i,it(r,r))}}(),ct=function(){let e=F(),n=F();return function(r,o,a,i,s,c){return w(e,o,s,c),w(n,a,i,c),w(r,e,n,2*c*(1-c)),r}}(),mt=function(){let e=A();return function(t,n,r,o){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],it(t,L(t,e))}}(),dt=document.createElement("canvas"),_t=dt.getContext("webgl"),lt={components:[],skip:!1};class ft{constructor(e={}){Object.assign(this,lt,e),this.entities=new Set,this.components=new Map,this.add_components(e.components)}add_component(e){e.entity=this,e.mount(),this.components.set(e.constructor,e)}add_components(e=[]){e.forEach((e)=>this.add_component(e))}get_component(e){return this.components.get(e)}get_components(...e){return e.map((e)=>this.get_component(e))}add(e){e.parent=this,this.entities.add(e)}update(e){if(!this.skip){const t=(t)=>t.update(e);this.components.forEach(t),this.entities.forEach(t)}}render(e){if(!this.skip){const t=(t)=>t.render(e);this.components.forEach(t),this.entities.forEach(t)}}}const ut={entity:null};class pt{constructor(e){Object.assign(this,ut,e)}mount(){}set(e){Object.assign(this,e)}update(){}render(){}}const gt={_scale:et.slice(),_rotation:F(),scale:et.slice(),position:V.slice(),rotation:F()};class ht extends pt{constructor(e){super(Object.assign({matrix:h(),world_matrix:h(),world_to_self:h()},gt,e))}get up(){const e=this.matrix.slice(4,7);return p(e,e)}get forward(){const e=this.matrix.slice(8,11);return p(e,e)}set position(e){b(this.matrix,this.rotation,e,this.scale)}get position(){return this.matrix.slice(12,15)}set scale(e){this._scale=e,b(this.matrix,this.rotation,this.position,e)}get scale(){return this._scale}set rotation(e){this._rotation=e,b(this.matrix,e,this.position,this.scale)}get rotation(){return this._rotation}look_at(e){const t=V.slice();m(t,e,this.position),p(t,t);const n=ot(t[2],0,-t[0]);p(n,n);const r=V.slice();f(r,t,n);const o=F();P(o,n,r,t),this.rotation=o}rotate_along(e,t){const n=F();R(n,e,t),T(n,this.rotation,n),this.rotation=n}rotate_rl(e){this.rotate_along(nt,e)}rotate_ud(e){this.rotate_along(tt,e)}translate(e){const t=V.slice();c(t,this.position,e),this.position=t}get_view_matrix(e){const t=[];return c(t,this.position,this.forward),x(e,this.position,t,this.up),e}update(){this.entity.parent?y(this.world_matrix,this.entity.parent.get_component(ht).world_matrix,this.matrix):this.world_matrix=this.matrix.slice(),v(this.world_to_self,this.world_matrix)}}const vt={material:null,vertices:[],indices:[],normals:[],color:"fff",color_opacity:1};class yt extends pt{constructor(e){super(e),Object.assign(this,vt,e),this.create_buffers()}set color(e){this._color=e||"fff",this.color_vec=[...r(this._color),this.color_opacity]}get color(){return this._color}create_buffers(){this.buffers={vertices:B(this.vertices),indices:U(this.indices),qty:this.indices.length,normals:B(this.normals)}}render(){this.material.render(this.entity)}}const bt=3,kt={keyboard_controlled:!1,mouse_controlled:!1,move_speed:3.5,rotate_speed:.5,dir_desc:{37:"yl",38:"pu",39:"yr",40:"pd",65:"l",68:"r",69:"u",81:"d",83:"b",87:"f"}};class xt extends pt{constructor(e){super(e),Object.assign(this,kt,e)}handle_keys(e,{f:t=0,b:n=0,l:o=0,r:a=0,u:r=0,d:i=0,pu:s=0,pd:c=0,yl:d=0,yr:l=0}){const f=this.entity.get_component(ht),u=e/1e3*this.move_speed,h=ot(o-a,0,t-n);g(h,h,f.matrix),m(h,h,f.position),h[1]=r-i,p(h,h),_(h,h,u),f.translate(h);this.handle_mouse(e,{x:d*bt-l*bt,y:s*bt-c*bt})}handle_mouse(e,{x:t,y:n}){const r=this.entity.get_component(ht);if(0!==t||0!==n){const o=e/1e3,a=this.rotate_speed*o*t,i=this.rotate_speed*o*n,s=ot(Fe(i)*Re(a),Re(i),Fe(i)*Fe(a));p(s,s),g(s,s,r.matrix),r.look_at(s)}}update(e){if(this.keyboard_controlled&&this.entity.game){const t={};for(const[e,n]of Object.entries(this.dir_desc))t[n]=this.entity.game.get_key(e);this.handle_keys(e,t)}this.mouse_controlled&&this.entity.game&&this.handle_mouse(e,this.entity.game.mouse_delta)}}const At={buffers:[],current_frame:0,next_frame:1,current_tick:0,frame_time:16};class Et extends pt{constructor(e){super(e),Object.assign(this,At,e),this.frames&&this.frames.length&&this.create_buffers()}create_buffers(){this.number_of_frames=this.frames.length,this.entity.get_component(yt).buffers=this.frames.map((e)=>({vertices:B(e.vertices),indices:U(e.indices),qty:e.indices.length,normals:B(e.normals)}))}get_next_frame(){let e=this.current_frame;return e++,e%this.number_of_frames}update(){this.current_tick++,this.frame_delta=1-this.current_tick%this.frame_time/this.frame_time,this.current_tick%this.frame_time||(this.current_frame=this.next_frame,this.next_frame=this.get_next_frame())}}const Ft={canvas:dt,width:800,height:600,dom:document.body,fps:60,running:!0,fov:60,near:0.35,far:85,clear_color:"#FFFFFF",light_position:V.slice(),light_intensity:0.6},Rt=["keydown","keyup","mousemove"];class Tt{constructor(e){Object.assign(this,Ft,e),this.canvas.width=this.width,this.canvas.height=this.height,this.dom.appendChild(dt),this.reset(),this.camera=new ft({components:[new ht,new xt]}),this.camera.game=this,this.projMatrix=h(),this.viewMatrix=h(),k(this.projMatrix,S(this.fov),this.width/this.height,this.near,this.far),this.tick_delta=1e3/this.fps;for(const t of Rt){const e="on"+t;this[e]=this[e].bind(this),window.addEventListener(t,this[e])}this.running&&this.start(),_t.enable(_t.CULL_FACE),_t.enable(_t.DEPTH_TEST),_t.clear(_t.DEPTH_BUFFER_BIT|_t.COLOR_BUFFER_BIT)}get clear_color(){return this._clear_color}set clear_color(e){this._clear_color=e;const t=r(e);_t.clearColor(t[0],t[1],t[2],1)}stop(){this.running=!1}start(){this.running=!0,this.last_tick=performance.now(),window.requestAnimationFrame((e)=>this.frame(e))}reset(){this.entities=new Set,this.listeners=new Map,this.keys={},this.mouse_delta={x:0,y:0}}destroy(){for(const e of Rt)window.removeEventListener(e,this[e])}emit(e,...t){if(this.listeners.has(e))for(const n of this.listeners.get(e))n(...t)}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.has(e)&&this.listeners.get(e).delete(t)}onkeydown(t){this.keys[t.keyCode]=1}onkeyup(t){this.keys[t.keyCode]=0}get_key(e){return this.keys[e]||0}onmousemove(t){this.mouse_delta.x-=t.movementX,this.mouse_delta.y-=t.movementY}frame(e){if(this.running&&window.requestAnimationFrame((e)=>this.frame(e)),e>this.last_tick+this.tick_delta){const t=e-this.last_tick,n=Ae(t/this.tick_delta);this.perform_ticks(n),this.render()}}perform_ticks(e){this.mouse_delta.x/=e,this.mouse_delta.y/=e;for(let t=0;t<e;t++)this.last_tick+=this.tick_delta,this.update();this.mouse_delta.x=0,this.mouse_delta.y=0}update(){this.emit("tick",this.last_tick),this.entities.forEach((e)=>e.update(this.tick_delta)),this.camera.update(this.tick_delta),this.camera.get_component(ht).get_view_matrix(this.viewMatrix)}render(){_t.clear(_t.COLOR_BUFFER_BIT|_t.DEPTH_BUFFER_BIT),_t.viewport(0,0,this.canvas.width,this.canvas.height),this.entities.forEach((e)=>e.render()),this.emit("afterrender")}add(e){e.game=this,this.entities.add(e)}remove(e){this.entities.delete(e)}}class wt{constructor(e){this.to=e.to,this.time=e.time||1e3,this.game=e.game,this.object=e.object,this.property=e.property,this.cb=e.cb}do_step(e){this.current_step=we(1,(e-this.first_tick)/this.tick_delta*this.step),this.action()}action(){}pre_start(){this.tick_delta=this.game.tick_delta,this.first_tick=this.game.last_tick,this.number_of_ticks=Math.ceil(this.time/this.tick_delta),this.step=1/this.number_of_ticks}start(){return this.pre_start(),new Promise((e)=>{const t=(n)=>{1===this.current_step?(this.game.off("tick",t),e()):this.do_step(n,e)};this.game.on("tick",t)})}}class Lt{constructor(){this.uniforms={},this.attribs={}}setup_program(){if(this.program=q(I(_t.VERTEX_SHADER,this.get_shader_code(this.vertex_shader.variables,this.vertex_shader.body)),I(_t.FRAGMENT_SHADER,this.get_shader_code(this.fragment_shader.variables,this.fragment_shader.body))),this.program.error)return void console.log(this.program.error)}get_uniforms_and_attrs(e,t){e.forEach((e)=>{this.uniforms[e]=_t.getUniformLocation(this.program,e)}),t.forEach((e)=>{this.attribs[e]=_t.getAttribLocation(this.program,e)})}get_shader_code(e,t){return`
      precision mediump float;
      ${e}

      void main()
      {
        ${t}
      }
    `}render(e){let t=e,n=t.game;for(;t.parent&&!n;)t=t.parent,n=t.game;const[r,o]=e.get_components(ht,yt);_t.useProgram(this.program),_t.uniformMatrix4fv(this.uniforms.p,_t.FALSE,n.projMatrix),_t.uniformMatrix4fv(this.uniforms.v,_t.FALSE,n.viewMatrix),_t.uniformMatrix4fv(this.uniforms.w,_t.FALSE,r.world_matrix),_t.uniform4fv(this.uniforms.c,o.color_vec),this.apply_shader(e,n)}}const Pt=[0.5,0.5,0.5,0.5,0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5],St=[0,2,1,2,3,1,4,6,5,6,7,5,8,10,9,10,11,9,12,14,13,14,15,13,16,18,17,18,19,17,20,22,21,22,23,21],Bt=[1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1];class Ut extends ft{constructor(e={}){e.components=[new ht,new yt({vertices:Pt,indices:St,normals:Bt,material:e.material})],super(e)}}const It=[-1,0,1,1,0,1,1,0,-1,-1,0,-1],qt=[0,1,3,3,1,2],Mt=[0,1,0,0,1,0,0,1,0,0,1,0];class Ct extends ft{constructor(e={}){e.components=[new ht,new yt({vertices:It,indices:qt,normals:Mt,material:e.material})],super(e)}}const Dt=0.5+2.23606797749979/2,Ot=[-1,Dt,0,1,Dt,0,-1,-Dt,0,1,-Dt,0,0,-1,Dt,0,1,Dt,0,-1,-Dt,0,1,-Dt,Dt,0,-1,Dt,0,1,-Dt,0,-1,-Dt,0,1],Nt=[-1,Dt,0,1,Dt,0,-1,-Dt,0,1,-Dt,0,0,-1,Dt,0,1,Dt,0,-1,-Dt,0,1,-Dt,Dt,0,-1,Dt,0,1,-Dt,0,-1,-Dt,0,1],jt=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];class Yt extends ft{constructor(e={}){e.components=[new ht,new yt({vertices:Ot,indices:jt,normals:Nt,material:e.material})],super(e)}}const Gt=new class extends Lt{constructor(){super(),this.vertex_shader={variables:`uniform mat4 p;
        uniform mat4 v;
        uniform mat4 w;
        uniform float frame_delta;
        uniform float do_morph;
        attribute vec3 P_current;
        attribute vec3 P_next;`,body:`if (do_morph == 1.0) {
        float next_frame_delta = 1.0 - frame_delta;
        gl_Position = p * v * vec4((w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz, 1.0);
      } else {
        gl_Position = p * v * vec4((w * vec4(P_current, 1.0)).xyz, 1.0);
      }`},this.fragment_shader={variables:"uniform vec4 c;",body:"gl_FragColor = c;"},this.setup_program(),this.get_uniforms_and_attrs(["p","v","w","c","frame_delta","do_morph"],["P_current","P_next"])}apply_shader(e){const[t,n]=e.get_components(yt,Et);let r=t.buffers;n?(r=t.buffers[n.current_frame],_t.bindBuffer(_t.ARRAY_BUFFER,t.buffers[n.next_frame].vertices),_t.vertexAttribPointer(this.attribs.P_next,3,_t.FLOAT,_t.FALSE,0,0),_t.enableVertexAttribArray(this.attribs.P_next),_t.uniform1f(this.uniforms.do_morph,1),_t.uniform1f(this.uniforms.frame_delta,n.frame_delta)):_t.uniform1f(this.uniforms.do_morph,0),_t.bindBuffer(_t.ARRAY_BUFFER,r.vertices),_t.vertexAttribPointer(this.attribs.P_current,3,_t.FLOAT,_t.FALSE,0,0),_t.enableVertexAttribArray(this.attribs.P_current),_t.bindBuffer(_t.ELEMENT_ARRAY_BUFFER,r.indices),_t.drawElements(_t.TRIANGLES,r.qty,_t.UNSIGNED_SHORT,0)}};const Ht=new class extends Lt{constructor(){super(),this.vertex_shader={variables:`  uniform mat4 p;
        uniform mat4 v;
        uniform mat4 w;
        uniform float frame_delta;
        uniform float do_morph;
        attribute vec3 P_current;
        attribute vec3 P_next;
        attribute vec3 N_current;
        attribute vec3 N_next;
        varying vec3 fp;
        varying vec3 fn;`,body:`if (do_morph == 1.0) {
        float next_frame_delta = 1.0 - frame_delta;
        fp = (w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz;
        fn = (w * vec4(N_next * next_frame_delta + N_current * frame_delta, 0.0)).xyz;
      } else {
        fp = (w * vec4(P_current, 1.0)).xyz;
        fn = (w * vec4(N_current, 0.0)).xyz;
      }
      gl_Position = p * v * vec4(fp, 1.0);`},this.fragment_shader={variables:`uniform vec3 lp;
        uniform vec4 c;
        uniform vec2 li;
        varying vec3 fp;
        varying vec3 fn;`,body:`gl_FragColor = vec4(c.rgb * li.x + li.y * max(dot(fn, normalize(lp - fp)), 0.0), c.a);`},this.setup_program(),this.get_uniforms_and_attrs(["p","v","w","lp","li","c","do_morph","frame_delta"],["P_current","P_next","N_current","N_next"])}apply_shader(e,t){const[n,r]=e.get_components(yt,Et);let o=n.buffers;r?(o=n.buffers[r.current_frame],_t.bindBuffer(_t.ARRAY_BUFFER,n.buffers[r.next_frame].vertices),_t.vertexAttribPointer(this.attribs.P_next,3,_t.FLOAT,_t.FALSE,0,0),_t.enableVertexAttribArray(this.attribs.P_next),_t.uniform1f(this.uniforms.do_morph,1),_t.uniform1f(this.uniforms.frame_delta,r.frame_delta)):_t.uniform1f(this.uniforms.do_morph,0),_t.bindBuffer(_t.ARRAY_BUFFER,o.vertices),_t.vertexAttribPointer(this.attribs.P_current,3,_t.FLOAT,_t.FALSE,0,0),_t.enableVertexAttribArray(this.attribs.P_current),_t.bindBuffer(_t.ARRAY_BUFFER,o.normals),_t.vertexAttribPointer(this.attribs.N_current,3,_t.FLOAT,_t.FALSE,0,0),_t.enableVertexAttribArray(this.attribs.N_current),_t.bindBuffer(_t.ELEMENT_ARRAY_BUFFER,o.indices),_t.drawElements(_t.TRIANGLES,o.qty,_t.UNSIGNED_SHORT,0),_t.uniform3fv(this.uniforms.lp,t.light_position),_t.uniform2fv(this.uniforms.li,[t.light_intensity,1-t.light_intensity])}},Vt=132079672568928;let Wt=Vt;const Xt=function(){return Wt=16807*Wt%2147483647,(Wt-1)/2147483646},Qt=(e,t,n)=>{let r=[];const o=Fe(e*Ee),a=Fe(e*Ee),i=75+100*Re(e*Ee/6);switch(n){case 0:case 1:for(let n=C(0,2);n--;){const n=C(5,80),s=C(5,80),c=new Ut;c.get_component(yt).set({material:Gt,color:t}),c.get_component(ht).set({position:[o*i+s,n/2,20*a*e],scale:[s,n,C(5,80)]}),r.push(c)}break;case 2:const s=new Yt,c=new Ut,m=C(12,17);c.get_component(ht).set({position:[o*i,m/2,20*a*e],scale:[1,m,1]}),c.get_component(yt).set({material:Gt,color:t}),r.push(c);const d=C(2,7);s.get_component(ht).set({position:[o*i,m,20*a*e],scale:[d,d,d]}),s.get_component(yt).set({material:Gt,color:t}),r.push(s);break;case 3:const _=new Ut;_.get_component(yt).set({color:"#000000",material:Gt}),_.get_component(ht).set({position:[0,1,0]}),r.push(_);}return r};class Kt extends ht{update(){this.position=this.entity.get_component(ht).position,this.look_at(this.target.position)}}const Jt=[2,1,0,6,3,0,6,0,9,2,0,3,2,1,0,6,3,0,6,0,9,2,0,3,19,1,2,19,1,2,2,16,19,2,16,19,2,3,16,2,3,16,16,3,6,16,6,17,16,3,6,16,6,17,7,18,17,7,17,6,7,18,17,7,17,6,10,11,18,10,18,7,10,11,18,10,18,7,8,11,10,8,10,7,8,11,10,8,10,7,9,8,7,9,8,7,9,7,6,9,7,6,6,5,4,6,4,3,14,5,6,12,14,6,12,6,3,6,5,4,6,4,3,14,5,6,12,14,6,12,6,3,4,12,3,4,12,3,5,13,4,13,12,4,5,13,4,13,12,4,15,14,12,15,12,13,15,14,12,15,12,13,14,15,5,14,15,5,5,15,13,5,15,13,20,21,22,29,20,23,23,20,22,20,21,22,29,20,23,23,20,22,22,21,39,22,21,39,36,23,22,39,36,22,36,23,22,39,36,22,37,23,36,37,23,36,26,37,38,37,26,23,26,37,38,37,26,23,23,25,26,26,27,28,26,28,29,26,38,27,29,23,26,26,25,34,23,26,34,23,25,26,26,27,28,26,28,29,26,38,27,29,23,26,26,25,34,23,26,34,27,38,30,27,30,28,27,38,30,27,30,28,38,31,30,38,31,30,30,31,28,30,31,28,33,32,34,33,34,35,23,34,32,25,35,34,33,32,34,33,34,35,23,34,32,25,35,34,24,33,35,24,32,33,24,33,35,24,32,33,23,32,24,23,32,24,23,24,25,23,24,25,24,35,25,24,35,25];class Zt extends wt{action(){const e=[];u(e,this.from,this.to,this.current_step),this.object[this.property]=e}pre_start(){super.pre_start(),this.from=this.object[this.property].slice()}}const $t=new(window.AudioContext||window.webkitAudioContext),zt=[220,246.942,261.626,293.665,329.628,349.228,415.305,440],en=$t.createBiquadFilter();en.type="lowpass",en.frequency.value=100,en.Q.value=10;const tn=$t.createConvolver();tn.buffer=z(10,10),en.connect(tn),tn.connect($t.destination);const nn={ifrq:0.0204082,atk:0.367347,dcy:0.183673,fmod1:0.0612245,atkf1:0,dcyf1:1,fmod2:0.285714,atkf2:0.22449,dcyf2:0.489796,amod1:0.367347,atka1:0.387755,dcya1:0.734694,amod2:0.204082,atka2:0.428571,dcya2:0.142857},rn=4,on=[[0,1,0.0432336,0,2.66717,-0.0897549,-0.311383,2.19602,0.234146,-0.63757,1.36243,0.125756,-2.39534,2.44478,-0.378434,-1.73172,-1.46682,-0.378434,-0.891271,-1.67049,0.125756,-2.88463,-2.81215,0.125755,0,-3.5,0.108391,0,-1.67049,-0.39161,-1.59801,-4.78739,0.125755,0,-5.27165,0.234146,-2.39534,2.44478,-0.126923,-3.45125,2.35058,-3.40775,-1.73172,-1.46682,-0.126923,-3.10363,0.637105,-3.60768,0,1,0.40839,0,-1.67049,0.464128,0,-2.87961,0.359902,0,2.16981,0.60839,0,1,0.0432336,0,2.66717,-0.0897549,0.311383,2.19602,0.234146,0.63757,1.36243,0.125756,2.39534,2.44478,-0.378434,1.73172,-1.46682,-0.378434,0.891271,-1.67049,0.125756,2.88463,-2.81215,0.125755,0,-3.5,0.108391,0,-1.67049,-0.39161,1.59801,-4.78739,0.125755,0,-5.27165,0.234146,2.39534,2.44478,-0.126923,3.45125,2.35058,-3.40775,1.73172,-1.46682,-0.126923,3.10363,0.637105,-3.60768,0,1,0.40839,0,-1.67049,0.464128,0,-2.87961,0.359902,0,2.16981,0.60839],[0,1,-0.18593,0,2.66717,-0.318919,-0.311383,2.19602,0.00498234,-0.63757,1.36243,0.125756,-2.13574,2.71753,0.924384,-1.27253,-1.44252,0.497551,-0.891271,-1.67049,0.125756,-2.88463,-2.81215,0.125755,0,-3.5,-0.120773,0,-1.67049,-0.620773,-1.59801,-4.78739,0.125755,0,-5.27165,0.00498211,-2.13066,2.69291,1.17464,-5.74559,1.12196,4.29641,-1.26745,-1.46715,0.747802,-5.69843,-0.612202,4.29641,0,1,0.179227,0,-1.67049,0.234964,0,-2.87961,0.130738,0,2.16981,0.379227,0,1,-0.18593,0,2.66717,-0.318919,0.311383,2.19602,0.00498234,0.63757,1.36243,0.125756,2.13574,2.71753,0.924384,1.27253,-1.44252,0.497551,0.891271,-1.67049,0.125756,2.88463,-2.81215,0.125755,0,-3.5,-0.120773,0,-1.67049,-0.620773,1.59801,-4.78739,0.125755,0,-5.27165,0.00498211,2.13066,2.69291,1.17464,5.74559,1.12196,4.29641,1.26745,-1.46715,0.747802,5.69843,-0.612202,4.29641,0,1,0.179227,0,-1.67049,0.234964,0,-2.87961,0.130738,0,2.16981,0.379227]].map((e)=>({vertices:e,indices:Jt})),an=1e3,sn=10*an,cn=0.7,mn=0.6,dn=1.74,_n=25,ln=25;let fn=[],un=[];const pn=5e3;let gn,hn={};const vn={level:null,hue:0,target:null,results:[],clickable:!0,idle_reason:null},yn={timeout:null,resuming:!1},bn=function(e){return function(t={},n,r){return Object.keys(e).reduce((o,a)=>Object.assign(o,{[a]:e[a](t[a],n,r)}),t)}}({nav:function(e=Qe,t,r){switch(t){case Pe:return n(e,{next:r});case Be:return n(e,{next:[null]});case Se:{const{next:[t]}=e;return n(e,{current_scene:t})}default:return e;}},game:function(e=vn,t,r){function o(){An(Ge),En(Ce)}switch(t){case Ne:{const t=localStorage.getItem("results"),r=t?t.split(" ").map((e)=>parseInt(e)):[];return n(e,{results:r})}case qe:{const[t]=r,[o,a]=me(t+1);return n(e,{index:t,level:o,hue:a,clickable:!1})}case Ve:{const{clickable:t}=e;return n(e,{clickable:!t})}case je:{const[t]=r;return n(e,{target:t})}case He:{const{level:t}=e;return t.canvas.requestPointerLock(),e}case Me:{const{level:t,hue:r,target:a}=e;return de(t,r,a),t.canvas.addEventListener("click",o),ue(),n(e,{idle_reason:null})}case Ye:{const[t]=r;return n(e,{idle_reason:t})}case Ge:{const{level:t,index:r,target:a,results:i}=e,s=_e(t,a),c=[...i.slice(0,r),s,...i.slice(r+1)];return pe(),t.canvas.removeEventListener("click",o),document.exitPointerLock(),localStorage.setItem("results",c.join(" ")),n(e,{results:c})}case De:return n(e,{level:null});default:return Object.assign({},vn,e);}},audio:function(e=yn,t){switch(t){case We:{const{timeout:t,resuming:r}=e;return r||t||$t.resume().then(()=>An(Xe)),n(e,{resuming:!0})}case Xe:{const t=te();return n(e,{resuming:!1,timeout:t})}}}}),{attach:kn,connect:xn,dispatch:An}=function(e){function t(){for(const[e,t]of r){const r=t();if(r!==o.get(e)){o.set(e,r),e.innerHTML=r;const t=new CustomEvent("render",{detail:n});e.dispatchEvent(t)}}}let n=e();const r=new Map,o=new Map;return{attach(e,n){r.set(n,e),t()},connect(e){return(...t)=>e(n,...t)},dispatch(r,...o){n=e(n,r,o),t()}}}(bn),En=(...e)=>An(Pe,...e);window.dispatch=An,window.goto=En,An(Ne);var Fn=xn((e,...t)=>ve(e.nav,...t));const Rn=[function(){return Fn({id:Ue,from:"#000",to:"#000"},e`
      <div class="ui action"
        onclick="dispatch(${We});goto(${Ie})">
        <div class="pad" style="margin: 1.3rem 0 1rem;">A moment lost in time.</div>
        <div style="font-size: 0.3rem; animation: fadein 1s 3s both">
          A story by <a href="https://piesku.com">piesku.com</a>.</div>
      </div>`)},function({results:t}){const n=t.length?`goto(${De})`:`goto(${qe}, 0)`;return Fn({id:Ie,from:"#000",to:"#000"},e`
      <div class="ui action" onclick="${n}">
        <div class="pad">
          Collect your memories before they fade away.
        </div>
      </div>`)},function({hue:e,clickable:t}){return Fn({id:qe,from:"#000",to:"#fff"},t?be():ye(e))},function({idle_reason:t}){const n="keydown"===t?"Walk with the WASD keys.":"Move the mouse.";return Fn({id:Me,from:"#fff",to:"#fff",duration_out:.1},e`<div class="ui"
      onclick="dispatch(${Ge}); goto(${Ce})">
        ${t&&`<div style="opacity: 0; animation: fadein 2s 1s alternate 2;">${n}</div>`}</div>`)},function({results:t,index:n,target:r}){const o=t[n],a=15>o?"Doesn't look like it.":35>o?"It was something else.":50>o?"It's not quite the same.":75>o?"Could it be?":85>o?"It reminds you of something.":95>o?"That's it, almost there.":"Wonderful. You've found it.";return Fn({id:Ce,from:"#fff",duration_in:1.9,to:"#000"},e`
      <img class="ui"
        style="opacity: .5"
        src="${r.snapshot}">
      <div class="ui action"
        onclick="goto(${De})">
        <div class="pad" style="margin: 1.5rem 0 1rem;">${a}</div>
        <div>${t[n]}</div>
      </div>`)},function({results:t}){const n=t.reduce((e,t)=>e+t),r=Ae(n/t.length),o=100*(1-2/t.length);return Fn({id:De,from:"#000",to:"#000"},e`
      <div class="ui" style="background: #111">
        <div class="pad">
          ${t.map(ke)}
          ${r>o?`<div class="box action"
                onclick="goto(${qe}, ${t.length})">next</div>`:`<div class="box action"
                onclick="goto(${Oe})"
                title="Collect more accurate moments before advancing.">â€¦?</div>`}
        </div>
      </div>`)},function(){return Fn({id:Oe,from:"#000",to:"#000"},e`
      <div class="ui action" style="background: #111"
        onclick="goto(${De})">
        <div class="pad">
          The path onward is never easy.
          Collect more accurate moments before venturing forth.
        </div>
      </div>`)}];var Tn=xn(function({game:e,nav:{current_scene:t}}){const n=Rn[t];return n?n(e):""});kn(Tn,document.querySelector("#root"))})();
